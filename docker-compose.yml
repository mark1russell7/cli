# Docker Compose for Mark CLI Server
#
# Usage:
#   docker compose up -d        # Start server
#   docker compose logs -f      # View logs
#   docker compose down         # Stop server
#
# Environment variables:
#   MARK_SERVER_PORT - Port to expose (default: 3000)

services:
  mark-server:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "${MARK_SERVER_PORT:-3000}:3000"
    volumes:
      # Persist lockfile and logs
      - mark-data:/root/.mark
    environment:
      - MARK_SERVER_PORT=3000
      - MARK_SERVER_HOST=0.0.0.0
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "node", "-e", "fetch('http://localhost:3000/health').then(r => r.ok ? process.exit(0) : process.exit(1)).catch(() => process.exit(1))"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 10s

volumes:
  mark-data:
    name: mark-cli-data
